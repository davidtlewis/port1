{% extends 'portfolio/base.html' %}
{% load tz %}
{% block content %}
<h3>Summary @ {{ updateTime|localtime|date:"D jS, H:i" }}</h3>
<h4>H&D: £{{ totalvalue |floatformat:0 }}  US${{ totalvalueUSD |floatformat:0 }}</h4>
<h4>All: £ {{ totals.account_value__sum |floatformat:0 }}</h4>
{% comment %} <button id="copybtn">Copy</button><br>
<button id="demo" onclick="copyToClipboard(document.getElementById('copytextarea').innerHTML)">This is what I want to
    copy</button> {% endcomment %}
<div id="copytextarea">
    {{accounts_by_type.4.total_value}}<br>
    {{accounts_by_type.3.total_value}}<br>
    {{pensions.1.account_value}}<br>
    {{USDGBP}}<br>
    {{pensions.2.account_value}}<br>
</div>

<!-- <a href="https://www.direct.aviva.co.uk/MyAccount/login" target="_blank"> Henri Pension</a>
|
<a href="https://finance.yahoo.com/quote/GBPUSD%3DX?p=GBPUSD%3DX" target="_blank">GBP/USD</a>
|<a href="https://www.iweb-sharedealing.co.uk/" target="_blank">iWeb</a> -->

<h3>By Person</h3>
<table style="width: 100%;" class="table table-striped table-condensed">
    <tr>
        <th style="width: 40%">Person</th>
        <th style="width: 60%">Total Value</th>
    </tr>
    {% for account_by_person in accounts_by_person %}
    <tr>
        <td><a href="/accountsfiltered/?person={{account_by_person.person__id}}">{{account_by_person.person__name }}</a></td></td></td>
        <td>{{account_by_person.total_value|floatformat:0}}</td>
    </tr>
    {% endfor %}
</table>


<h3>By Account Type (D & H)</h3>
<table style="width: 100%;" class="table table-striped table-condensed">
    <tr>
        <th style="width: 40%">Type</th>
        <th style="width: 60%">Total Value</th>
    </tr>
    {% for account_by_type in accounts_by_type %}
    <tr>
        <td>{{ account_by_type.account_type }}</td>
        <td>{{account_by_type.total_value|floatformat:0}}</td>
    </tr>
    {% endfor %}
</table>



{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelector('#copybtn').addEventListener('click', function (event) {
            var copyTextarea = document.querySelector('#copytextarea');
            copyTextarea.focus();
            copyTextarea.select();

            try {
                var successful = document.execCommand('copy');
                var msg = successful ? 'successful' : 'unsuccessful';
                console.log('Copying text command was ' + msg);
            } catch (err) {
                console.log('Oops, unable to copy');
            }
        })
    });

    function copyToClipboard(text) {
        window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
    }
</script>

{% endblock %}